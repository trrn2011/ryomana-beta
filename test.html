<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>身長クイズ｜縦スクロール版</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    #marker { transition: top 0.05s linear; }
    .tabular { font-variant-numeric: tabular-nums; }
  </style>
</head>
<body class="bg-gradient-to-br from-white via-pink-50 to-pink-100 text-gray-800 min-h-screen flex flex-col items-center py-8 gap-6">
  <h1 class="text-3xl md:text-4xl font-bold text-center">身長クイズ︰合計は何cm？</h1>
  <p class="text-sm text-gray-600 mb-2">①新郎を発表 → ボタンを押して ②合計＆新婦を発表</p>

  <!-- ===== レイアウト ===== -->
  <div class="flex flex-col md:flex-row gap-8 w-full max-w-5xl justify-center items-start">
    <!-- 縦線 & 数値 -->
    <div class="flex flex-col items-center w-full md:w-1/2">
      <div class="relative h-[60vh] w-28 flex justify-center select-none mb-4">
        <div class="absolute inset-y-4 left-1/2 -translate-x-1/2 w-1.5 bg-gray-500 rounded"></div>
        <div id="labels" class="absolute inset-0"></div>
        <div id="marker" class="absolute left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-6 h-6 bg-rose-600 rounded-full shadow-md"></div>
      </div>
      <div id="numberDisplay" class="tabular text-6xl md:text-7xl font-extrabold text-blue-600">---</div>
    </div>

    <!-- 回答枠 & 予想テーブル -->
    <div class="w-full md:w-1/2 flex flex-col items-stretch">
      <div id="answers" class="space-y-2 mb-3 md:space-y-2">
        <div id="groomBox" class="tabular w-full bg-blue-100 border border-blue-300 rounded-lg px-4 py-2 text-blue-700 font-semibold text-center">新郎：??? cm</div>
        <div id="brideBox" class="tabular w-full bg-pink-100 border border-pink-300 rounded-lg px-4 py-2 text-pink-700 font-semibold text-center">新婦：??? cm</div>
      </div>

      <table id="guessTable" class="w-full text-center border-collapse border border-gray-300 shadow-lg rounded-2xl overflow-hidden">
        <thead class="bg-blue-50 text-gray-700"><tr><th class="p-2">ゲスト</th><th class="p-2">予想(cm)</th><th class="p-2">差(cm)</th></tr></thead>
        <tbody id="guessBody" class="bg-white"></tbody>
      </table>
    </div>
  </div>

  <button id="controlBtn" class="mt-6 px-10 py-4 bg-indigo-600 text-white rounded-full shadow-lg text-xl hover:bg-indigo-700 active:scale-95 transition">スタート！</button>

<script>
/***** 設定 *****/
const brideHeight  = 165; // ← 実数
const groomHeight  = 180; // ← 実数
const durationGroom = 5000; // ms
const durationTotal = 8000; // ms
const shrinkRate   = 0.3;

const guesses=[
  {name:"みき",guess:340},
  {name:"たかし",guess:345},
  {name:"ゆうこ",guess:350},
  {name:"けんじ",guess:330}
];

/***** 要素 *****/
const total = brideHeight + groomHeight;
const numberDisplay = document.getElementById('numberDisplay');
const controlBtn    = document.getElementById('controlBtn');
const groomBox      = document.getElementById('groomBox');
const brideBox      = document.getElementById('brideBox');
const guessBody     = document.getElementById('guessBody');
const labelsDiv     = document.getElementById('labels');
const marker        = document.getElementById('marker');

/***** スケール *****/
const minVal=100;
const maxVal=Math.max(...guesses.map(g=>g.guess),groomHeight,total)+20;
function valToPercent(v){return (maxVal-v)/(maxVal-minVal)*100;}
function drawLabels(){
  labelsDiv.innerHTML='';
  for(let v=minVal;v<=maxVal;v+=50){
    const d=document.createElement('div');
    d.className='absolute tabular text-sm -translate-y-1/2 left-[calc(50%+10px)]';
    d.style.top=`${valToPercent(v)}%`;
    d.textContent=v;
    labelsDiv.appendChild(d);
  }
  marker.style.top=`${valToPercent(minVal)}%`;
}
drawLabels();

/***** 予想表 *****/
function renderTable(){
  guessBody.innerHTML='';
  guesses.forEach(g=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td class="p-2 border">${g.name}</td><td class="p-2 border">${g.guess}</td><td class="p-2 border">--</td>`;
    guessBody.appendChild(tr);
  });
}
renderTable();
function calcWinner(){
  let best=null;
  guesses.forEach(g=>{g.diff=Math.abs(g.guess-total);if(!best||g.diff<best.diff)best=g;});
  return best;
}
function updateDiffs(){
  guessBody.querySelectorAll('tr').forEach((tr,i)=>{
    const g=guesses[i];
    tr.children[2].textContent=g.diff.toFixed(1);
    if(g.isWinner) tr.classList.add('bg-yellow-200','font-bold');
  });
}

/***** アニメ *****/
function animateBounce({start,target,amp,duration,onDone}){
  const t0=performance.now();
  let lower=Math.max(minVal,Math.min(start,target)-amp);
  let upper=Math.min(maxVal,Math.max(start,target)+amp);
  let pos=start;
  let dir=(target>start)?1:-1;
  const speed=amp/35;
  function frame(now){
    if(now-t0>=duration){
      marker.style.top=`${valToPercent(target)}%`;
      numberDisplay.textContent=`${target.toFixed(1)} cm`;
      onDone();return;
    }
    pos+=dir*speed;
    if(dir===1&&pos>=upper){dir=-1;upper=Math.max(target,upper-(upper-target)*shrinkRate);} else if(dir===-1&&pos<=lower){dir=1;lower=Math.min(target,lower+(target-lower)*shrinkRate);} 
    pos=Math.max(minVal,Math.min(maxVal,pos));
    marker.style.top=`${valToPercent(pos)}%`;
    numberDisplay.textContent=`${pos.toFixed(1)} cm`;
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
}

/***** 制御 *****/
let phase=0; // 0: not started, 1: groom done, 2: finished
controlBtn.addEventListener('click',()=>{
  if(phase===0){ // start groom
    controlBtn.disabled=true;
    animateBounce({start:minVal,target:groomHeight,amp:50,duration:durationGroom,onDone:()=>{
      groomBox.textContent=`新郎：${groomHeight.toFixed(1)} cm`;
      groomBox.classList.add('bg-blue-200');
      numberDisplay.classList.add('text-blue-700');
      phase=1;
      controlBtn.textContent='合計を発表！';
      controlBtn.disabled=false;
    }});
  } else if(phase===1){ // start total
    controlBtn.disabled=true;
    animateBounce({start:groomHeight,target:total,amp:45,duration:durationTotal,onDone:()=>{
      brideBox.textContent=`新婦：${brideHeight.toFixed(1)} cm`;
      brideBox.classList.add('bg-pink-200');
      numberDisplay.classList.replace('text-blue-700','text-green-600');
      numberDisplay.classList.add('scale-110');
      numberDisplay.textContent=`${total.toFixed(1)} cm`;
      const winner=calcWinner();
      winner.isWinner=true;
      updateDiffs();
      confetti({particleCount:250,spread:80,origin:{y:0.6}});
      phase=2;
      controlBtn.textContent='完了';
    }});
  }
});
</script>
</body>
</html>